<div class="dashboard-container">
    <header class="dashboard-header">
        <div class="header-content">
            <h1>Registro de Certificados</h1>
            <section class="export-section">
                <button id="export-btn" class="btn-export" (click)="exportToCSV()">Descargar en CSV</button>
                <button id="refresh-btn" class="btn-refresh" (click)="loadData()">Actualizar</button>
            </section>
        </div>
    </header>

    <main class="dashboard-main">
        <!-- Estad√≠sticas -->
        <section class="stats-section">
            <div class="stat-card">
                <h3>Total de Registros</h3>
                <p class="stat-number">{{ totalRecords }}</p>
            </div>
            <div class="stat-card">
                <h3>Luces Registradas</h3>
                <p class="stat-number">{{ totalLights | number:'1.0-0' }}</p>
            </div>
            <div class="stat-card">
                <h3>Detectores Registrados</h3>
                <p class="stat-number">{{ totalDh | number:'1.0-0' }}</p>
            </div>
            <div class="stat-card">
                <h3>√öltimos 24h</h3>
                <p class="stat-number">{{ last24h }}</p>
            </div>
        </section>

        <!-- Filtros -->
        <section class="filters-section">
            <input type="text" class="search-box" placeholder="üîç Buscar por nombre de tienda o tipo..."
                [(ngModel)]="search" (input)="onSearch(search)" />

            <select class="sort-select" [(ngModel)]="sortType" (change)="applySort()">
                <option value="newest">M√°s recientes primero</option>
                <option value="oldest">M√°s antiguos primero</option>
                <option value="name">Por nombre de tienda (A-Z)</option>
                <option value="lights">Por cantidad de luces (mayor a menor)</option>
            </select>
        </section>

        <!-- Tabla -->
        <section class="table-section">
            <div class="table-wrapper" *ngIf="filteredRecords.length > 0; else noRecords">
                <table class="records-table">
                    <thead>
                        <tr>
                            <th>Tienda / Empresa</th>
                            <th>Tipo</th>
                            <th>Cantidad de Luces</th>
                            <th>Fecha Emisi√≥n</th>
                            <th>Registrado el</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let record of filteredRecords">
                            <td>
                                <strong>{{ record.nombre || 'Tienda desconocida' }}</strong>
                            </td>
                            <td>
                                <span class="badge">
                                    {{ record.tipo }}
                                </span>
                            </td>
                            <td class="text-center">{{ record.cantidad }}</td>
                            <td>{{ record.fechaEmision }}</td>
                            <td>{{ record.createdAt | date:'dd MMM yyyy HH:mm' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <ng-template #noRecords>
                <div class="no-records">
                    <p>No hay certificados registrados a√∫n</p>
                </div>
            </ng-template>
        </section>
    </main>
</div>